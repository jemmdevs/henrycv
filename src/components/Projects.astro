---
interface Project {
  name: string;
  description: string;
  image: string;
  type: "image" | "video";
  link: string;
  poster?: string;
}

const column1: Project[] = [
  {
    name: "Alawal",
    description: "DIGITAL TOOLMAKING",
    image: "/images/alawalPoster.avif",
    type: "image",
    link: "/projects/alawal",
  },
  {
    name: "Aisac",
    description: "DIGITAL TOOLMAKING",
    image: "/images/aisac.avif",
    type: "image",
    link: "/projects/aisac",
  },
  {
    name: "Doka",
    description: "DIGITAL TOOLMAKING",
    image: "/images/dokaPoster.avif",
    type: "image",
    link: "/projects/doka",
  },
];

const column2: Project[] = [
  {
    name: "General Dynamics",
    description: "DIGITAL TOOLMAKING",
    image: "/images/GDELS.svg",
    type: "image",
    link: "/projects/gdels",
  },
  {
    name: "Mirilab",
    description: "DIGITAL TOOLMAKING",
    image: "/images/mirilabPoster.avif",
    type: "image",
    link: "/projects/mirilab",
  },
];

const column3: Project[] = [
  {
    name: "Tousys",
    description: "DIGITAL TOOLMAKING",
    image: "/images/tousys.webm",
    type: "video",
    link: "/projects/tousys",
  },
  {
    name: "Azuki",
    description: "CONSUMER PRODUCT",
    image: "/images/azuki.avif",
    type: "image",
    link: "/projects/azuki",
  },
];

const allColumns = [column1, column2, column3];
---

<section class="px-3 py-6 max-w-[1800px] mx-auto">
  <div class="grid grid-cols-12 gap-3">
    <div class="col-span-12 grid md:grid-cols-3 gap-3">
      {
        allColumns.map((column, columnIndex) => (
          <div class="flex flex-col gap-6">
            {column.map((project, projectIndex) => (
              <a
                href={project.link}
                class="project-card w-full cursor-pointer block"
                data-column={columnIndex}
                data-index={projectIndex}
              >
                {project.type === "video" ? (
                  <video
                    src={project.image}
                    poster={project.poster}
                    class="w-full h-auto object-cover"
                    autoplay
                    loop
                    muted
                    playsinline
                    preload="metadata"
                  />
                ) : (
                  <img
                    src={project.image}
                    alt={`${project.name} - ${project.description}`}
                    class="w-full h-auto object-cover"
                    loading="lazy"
                    decoding="async"
                  />
                )}
                <div class="mt-3">
                  <h3 class="font-medium project-title">{project.name}</h3>
                  <p
                    class="uppercase project-description"
                    style="font-family: 'JetBrains Mono', monospace; font-size: 11.5px; line-height: 160%; letter-spacing: 0.08em; color: #71717a;"
                  >
                    {project.description}
                  </p>
                </div>
              </a>
            ))}
          </div>
        ))
      }
    </div>
  </div>
</section>

<style>
  .project-title {
    font-size: 14px;
    line-height: 20px;
  }

  @media (min-width: 768px) {
    .project-title {
      font-size: 15px;
      line-height: 140%;
    }
  }

  /* GPU-accelerated hover transition */
  .project-card {
    transition:
      opacity var(--duration-normal, 250ms)
        var(--ease-out-quart, cubic-bezier(0.25, 1, 0.5, 1)),
      transform var(--duration-normal, 250ms)
        var(--ease-out-quart, cubic-bezier(0.25, 1, 0.5, 1));
    transform: translateZ(0);
    backface-visibility: hidden;
    will-change: opacity, transform;
  }

  .project-card:hover {
    opacity: 0.8;
  }

  /* Remove will-change after interaction for memory optimization */
  .project-card:not(:hover) {
    will-change: auto;
  }

  @media (prefers-reduced-motion: reduce) {
    .project-card {
      transition: none;
      will-change: auto;
    }
  }
</style>

<script>
  import {
    observeAllVideos,
    setupVideoObserverCleanup,
  } from "../utils/videoObserver";

  // Observe all project videos
  observeAllVideos(".project-card video");

  // Setup cleanup for View Transitions
  setupVideoObserverCleanup();
</script>

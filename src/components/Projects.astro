---
// Definir tipo para proyectos
interface Project {
  name: string;
  description: string;
  image: string;
  type: 'image' | 'video';
  link: string;
  poster?: string; // Opcional, solo para videos
}

// Distribuir proyectos en 3 columnas
const column1: Project[] = [
  {
    name: "Alawal",
    description: "DIGITAL TOOLMAKING",
    image: "/images/alawalProject.avif",
    type: "image",
    link: "/projects/alawal"
  },
  {
    name: "Azuki",
    description: "CONSUMER PRODUCT",
    image: "/images/azuki.avif",
    type: "image",
    link: "/projects/azuki"
  }
];

const column2: Project[] = [
  {
    name: "Tousys",
    description: "DIGITAL TOOLMAKING",
    image: "/images/tousys.webm",
    type: "video",
    link: "/projects/tousys"
  },
  {
    name: "General Dynamics",
    description: "DIGITAL TOOLMAKING",
    image: "/images/GDELS.svg",
    type: "image",
    link: "/projects/gdels"
  },
  
];

const column3: Project[] = [
  {
    name: "Mirilab",
    description: "DIGITAL TOOLMAKING",
    image: "/images/mirilabProject.avif",
    type: "image",
    link: "/projects/mirilab"
  },
  {
    name: "Multimodal Search",
    description: "BRAIN TECHNOLOGIES",
    image: "/images/multimodal.mp4",
    poster: "/images/brain.avif",
    type: "video",
    link: "/projects/multimodal"
  },
  
];

// Combinar todas las columnas para renderizado
const allColumns = [column1, column2, column3];
---

<section class="px-3 py-6 max-w-[1800px] mx-auto">
  <!-- Container 12 columnas -->
  <div class="grid grid-cols-12 gap-3">
    <!-- Grid de proyectos: ocupa 12 columnas -->
    <div class="col-span-12 grid md:grid-cols-3 gap-3">
      
      {allColumns.map((column, columnIndex) => (
        <!-- Columna dinámica -->
        <div class="flex flex-col gap-6">
          {column.map((project, projectIndex) => (
            <a 
              href={project.link} 
              class="project-card w-full cursor-pointer block"
              data-column={columnIndex}
              data-index={projectIndex}
            >
              {project.type === 'video' ? (
                <video 
                  src={project.image}
                  poster={project.poster}
                  class="w-full h-auto object-cover"
                  autoplay
                  loop
                  muted
                  playsinline
                  preload="metadata"
                />
              ) : (
                <img 
                  src={project.image} 
                  alt={`${project.name} - ${project.description}`}
                  class="w-full h-auto object-cover"
                  loading="lazy"
                  decoding="async"
                />
              )}
              <div class="mt-3">
                <h3 class="font-medium project-title">{project.name}</h3>
                <p 
                  class="uppercase project-description"
                  style="font-family: 'JetBrains Mono', monospace; font-size: 11.5px; line-height: 160%; letter-spacing: 0.08em; color: #71717a;"
                >
                  {project.description}
                </p>
              </div>
            </a>
          ))}
        </div>
      ))}

    </div>
  </div>
</section>

<style>
  /* Mobile: 14px / 20px */
  .project-title {
    font-size: 14px;
    line-height: 20px;
  }

  /* Desktop (≥768px): 15px / 140% */
  @media (min-width: 768px) {
    .project-title {
      font-size: 15px;
      line-height: 140%;
    }
  }

  /* Transición de opacidad optimizada con GPU */
  .project-card {
    transition: opacity var(--duration-normal, 250ms) var(--ease-out-quart, cubic-bezier(0.25, 1, 0.5, 1));
  }

  .project-card:hover {
    opacity: 0.8;
  }

  /* Reducir movimiento si el usuario lo prefiere */
  @media (prefers-reduced-motion: reduce) {
    .project-card {
      transition: none;
    }
  }
</style>

<script>
  // Intersection Observer para pausar videos fuera del viewport
  // Esto ahorra recursos significativos en páginas con múltiples videos
  
  const videoObserver = new IntersectionObserver(
    (entries) => {
      entries.forEach((entry) => {
        const video = entry.target as HTMLVideoElement;
        
        if (entry.isIntersecting) {
          // Video visible: reproducir
          video.play().catch(() => {
            // Silenciar error si autoplay no está permitido
          });
        } else {
          // Video fuera de vista: pausar para ahorrar recursos
          video.pause();
        }
      });
    },
    {
      rootMargin: '50px 0px', // Comenzar un poco antes de entrar en viewport
      threshold: 0.1
    }
  );

  // Observar todos los videos de proyectos
  document.querySelectorAll('.project-card video').forEach((video) => {
    videoObserver.observe(video);
  });

  // Limpiar observer al cambiar de página (Astro View Transitions)
  document.addEventListener('astro:before-preparation', () => {
    videoObserver.disconnect();
  });
</script>
